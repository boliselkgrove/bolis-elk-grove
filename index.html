<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bolis Pickup Orders</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-pink-200 via-yellow-100 to-blue-200 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-4xl font-bold mb-6 text-pink-600">üçß Bolis Pickup Orders</h1>

  <!-- Order Form -->
  <form id="orderForm" class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-xl">
    <!-- Customer Info -->
    <label for="customerName" class="block mb-2 font-semibold">Your Name</label>
    <input type="text" id="customerName" required
           class="w-full p-2 mb-4 border rounded" />

    <label for="customerEmail" class="block mb-2 font-semibold">Your Email</label>
    <input type="email" id="customerEmail" required
           class="w-full p-2 mb-4 border rounded" />

    <!-- Flavor Grid -->
    <label class="block mb-2 font-semibold">Flavors (qty)</label>
    <div id="flavors" class="grid grid-cols-2 gap-2 mb-4">
      <!-- Each input has a data-flavor attribute -->
      <div>
        <label for="flavor-oreo">Oreo</label>
        <input id="flavor-oreo" type="number" min="0" value="0"
               data-flavor="Oreo"
               class="flavor w-full p-1 border rounded" />
      </div>
      <div>
        <label for="flavor-nutella">Nutella</label>
        <input id="flavor-nutella" type="number" min="0" value="0"
               data-flavor="Nutella"
               class="flavor w-full p-1 border rounded" />
      </div>
      <!-- Add your other flavors similarly -->
      <div>
        <label for="flavor-mango-chili">Mango Chili</label>
        <input id="flavor-mango-chili" type="number" min="0" value="0"
               data-flavor="Mango Chili"
               class="flavor w-full p-1 border rounded" />
      </div>
      <!-- ... -->
    </div>

    <!-- Payment Method -->
    <label for="paymentMethod" class="block mb-2 font-semibold">Payment Method</label>
    <select id="paymentMethod" class="w-full p-2 mb-4 border rounded">
      <option>Apple Pay</option>
      <option>Cash on Pickup</option>
    </select>

    <!-- Place Order -->
    <button id="submitBtn" type="submit"
            class="w-full bg-pink-500 hover:bg-pink-600 text-white p-3 rounded-xl font-bold">
      Place Order
    </button>
  </form>

  <!-- Confirmation Message -->
  <div id="confirmation" aria-live="polite"
       class="hidden mt-6 p-4 bg-green-100 rounded max-w-xl text-center">
    <h2 class="font-bold text-xl mb-2">Thank you, <span id="confName"></span>!</h2>
    <p>Your order of <span id="confTotal"></span> bolis is confirmed.</p>
    <p>Confirmation sent to <span id="confEmail"></span>.</p>
  </div>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize EmailJS
      emailjs.init('jNjnwDTehjtDEem4i');

      // Pricing tiers
      const priceTiers = [
        { qty: 100, price: 200 },
        { qty:  48, price: 104 },
        { qty:  36, price:  84 },
        { qty:  24, price:  60 },
        { qty:  12, price:  32 },
        { qty:   1, price:   3 }
      ];

      // Calculate total cost
      function calculateTotal(orderCounts) {
        let totalBolis = Object.values(orderCounts).reduce((a, b) => a + b, 0);
        return priceTiers.reduce((sum, tier) => {
          const bundles = Math.floor(totalBolis / tier.qty);
          sum += bundles * tier.price;
          totalBolis %= tier.qty;
          return sum;
        }, 0);
      }

      // Form submission
      const form       = document.getElementById('orderForm');
      const submitBtn  = document.getElementById('submitBtn');
      const confirmation = document.getElementById('confirmation');

      form.addEventListener('submit', e => {
        e.preventDefault();
        submitBtn.disabled = true;

        const name  = form.customerName.value.trim();
        const email = form.customerEmail.value.trim();
        const payment = form.paymentMethod.value;
        const flavors = form.querySelectorAll('.flavor');

        // Build orderCounts & summary
        let orderCounts = {}, summaryLines = [];
        flavors.forEach(f => {
          const qty = parseInt(f.value) || 0;
          if (qty > 0) {
            orderCounts[f.dataset.flavor] = qty;
            summaryLines.push(`${f.dataset.flavor}: ${qty}`);
          }
        });

        // Prevent empty orders
        if (!summaryLines.length) {
          alert('Please select at least one bolis flavor.');
          submitBtn.disabled = false;
          return;
        }

        const total = calculateTotal(orderCounts);
        const summary = summaryLines.join('\n');

        // Template params
        const params = {
          customer_name:  name,
          customer_email: email,
          order_summary:  summary,
          order_total:    `$${total}`,
          payment_method: payment
        };

        // Send emails
        Promise.all([
          emailjs.send('service_os7de1n','template_5plcqxe', params),
          emailjs.send('service_os7de1n','template_se19j7c', params)
        ])
        .then(() => {
          // Show confirmation
          form.classList.add('hidden');
          document.getElementById('confName').textContent  = name;
          document.getElementById('confEmail').textContent = email;
          document.getElementById('confTotal').textContent = `$${total}`;
          confirmation.classList.remove('hidden');
        })
        .catch(err => {
          console.error('EmailJS error:', err);
          alert('Oops! Something went wrong. Please try again.');
        })
        .finally(() => {
          submitBtn.disabled = false;
        });
      });
    });
  </script>
</body>
</html>
